<!DOCTYPE html>

<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Aproveitamento de Estudos</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <h2>Solicitação de Aproveitamento de Estudos</h2>

  <div id="disciplinas">
    <div class="disciplina">
      <label>IES de origem:
        <select class="ies-select" onchange="mostrarCampoIES(this)">
          <option value="UFMT">UFMT</option>
          <option value="Externa">Externa</option>
        </select>
      </label>
      <label class="ies-externa">
        Qual instituição?
        <input type="text" class="ies-outra" placeholder="Nome da instituição" />
      </label>

      <label>Disciplina cursada:
        <input type="text" class="disciplina-cursada" placeholder="Ex: Álgebra Linear" />
      </label>
      <label>Código da cursada:
        <input type="text" class="codigo-cursada" placeholder="Ex: MAT123" />
      </label>
      <label>Nota:
        <input type="text" class="nota" placeholder="Ex: 8.5" />
      </label>
      <label>Disciplina a aproveitar:
        <select class="disciplina-aproveitar" onchange="atualizarDisciplina(this)">
          <option value="">Carregando...</option>
        </select>
      </label>
      <label>Código da a aproveitar:
        <input type="text" readonly class="codigo-aproveitar" />
      </label>
    </div>
  </div>

  <button onclick="addDisciplina()">Adicionar outra disciplina</button>
  <button onclick="gerarPDF()">Gerar PDF</button>

  <script>
document.addEventListener("DOMContentLoaded", () => {
  let disciplinas = [];

  fetch("disciplinas.json")
    .then(res => res.json())
    .then(data => {
      disciplinas = data;
      preencherSelects();
    })
    .catch(err => console.error("Erro ao carregar disciplinas:", err));

  function preencherSelects() {
    document.querySelectorAll(".disciplina-aproveitar").forEach(select => {
      select.innerHTML = "<option value=''>Selecione</option>";
      disciplinas.forEach(d => {
        const option = document.createElement("option");
        option.value = d.codigo;
        option.textContent = `${d.codigo} - ${d.nome}`;
        select.appendChild(option);
      });
    });
  }

  document.getElementById("adicionarDisciplina").addEventListener("click", () => {
    const container = document.getElementById("disciplinas");
    const modelo = container.querySelector(".disciplina");
    const clone = modelo.cloneNode(true);

    // Limpa os campos do clone
    clone.querySelectorAll("input").forEach(input => input.value = "");
    clone.querySelectorAll("select").forEach(select => select.selectedIndex = 0);
    clone.querySelector(".ies-externa").style.display = "none";

    container.appendChild(clone);
    preencherSelects();
  });

  document.getElementById("gerarPDF").addEventListener("click", () => {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    let y = 20;
    const lineHeight = 7;

    document.querySelectorAll(".disciplina").forEach((div, index) => {
      const cursada = div.querySelector(".disciplina-cursada").value;
      const codigoCursada = div.querySelector(".codigo-cursada").value;
      const nota = div.querySelector(".nota").value;

      const codigoAproveitar = div.querySelector(".disciplina-aproveitar").value;
      const nomeAproveitar = disciplinas.find(d => d.codigo === codigoAproveitar)?.nome || "-";

      const ies = div.querySelector(".ies-select").value;
      const externa = div.querySelector(".ies-outra").value;
      const iesTexto = ies === 'Externa' ? externa : ies;

      const linhas = [
        `Disciplina Cursada: ${codigoCursada} - ${cursada}`,
        `Nota: ${nota}`,
        `Aproveitar como: ${codigoAproveitar} - ${nomeAproveitar}`,
        `IES de Origem: ${iesTexto}`
      ];

      linhas.forEach(linha => {
        const split = doc.splitTextToSize(linha, 170);
        split.forEach(txt => {
          doc.text(txt, 20, y);
          y += lineHeight;
        });
        y += 3;
      });

      if (y > 270) {
        doc.addPage();
        y = 20;
      }
    });

    doc.save("aproveitamento_estudos.pdf");
  });

  document.addEventListener("change", e => {
    if (e.target.classList.contains("ies-select")) {
      const externaField = e.target.closest(".disciplina").querySelector(".ies-externa");
      externaField.style.display = e.target.value === "Externa" ? "block" : "none";
    }

    if (e.target.classList.contains("disciplina-aproveitar")) {
      const selected = e.target.value;
      const codigoInput = e.target.closest(".disciplina").querySelector(".codigo-aproveitar");
      codigoInput.value = selected;
    }
  });
});
</script>


</body>
</html>
